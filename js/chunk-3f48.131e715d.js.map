{"version":3,"sources":["webpack:///./src/views/p2pConfig/user/index.vue?4b87","webpack:///./src/api/user/p2pConfig.js","webpack:///src/views/p2pConfig/user/index.vue","webpack:///./src/views/p2pConfig/user/index.vue?ae2d","webpack:///./src/views/p2pConfig/user/index.vue","webpack:///./src/api/userDomain.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","style","device","staticStyle","margin-bottom","attrs","title","$t","directives","name","rawName","value","expression","border","data","tableData","align","prop","label","formatter","formatterStatus","scopedSlots","_u","key","fn","scope","row","blocked","_v","_s","_e","disable_p2p","active-color","inactive-color","on","change","handleSwitchChange","staticRenderFns","p2pConfig","user_id","domain_id","Object","request","url","concat","method","uservue_type_script_lang_js_","loading","switchValue","computed","objectSpread","vuex_esm","mounted","fetchTableData","methods","page","pageSize","_this","userDomain","then","res","filter","item","isValid","catch","err","console","log","handleP2PConfig","uid","id","_this2","succeed","$message","message","type","forEach","disable","error","domain","p2pConfig_uservue_type_script_lang_js_","component","componentNormalizer","options","__file","__webpack_exports__","fetchHostNum","_utils_request__WEBPACK_IMPORTED_MODULE_5__","Date","getTime","toFixed","fetchDomain","order","filters","blockDomain","whiteDomain","searchHost","host","fetchUserList","fetchUserDomain","_utils_auth__WEBPACK_IMPORTED_MODULE_6__","bindDomain","checkDomain","domainID","deleteDomain","fetchAdminUser"],"mappings":"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","file":"js/chunk-3f48.131e715d.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{style:(_vm.device === 'mobile' ? '' : 'padding: 30px 120px')},[_c('el-alert',{staticStyle:{\"margin-bottom\":\"20px\"},attrs:{\"title\":_vm.$t('p2pConfig.desc')}}),_c('el-table',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"border\":\"\",\"data\":_vm.tableData}},[_c('el-table-column',{attrs:{\"align\":\"center\",\"prop\":\"domain\",\"label\":_vm.$t('domainTable.domain')}}),_c('el-table-column',{attrs:{\"align\":\"center\",\"formatter\":_vm.formatterStatus,\"label\":_vm.$t('p2pConfig.status')},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('span',{style:(scope.row.blocked?'color: red':'')},[_vm._v(\"\\n          \"+_vm._s(_vm.formatterStatus(scope.row))+\"\\n        \")])]}}])}),_c('el-table-column',{attrs:{\"label\":_vm.$t('domainTable.operation'),\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.blocked)?_c('el-switch',{attrs:{\"value\":!scope.row.disable_p2p,\"active-color\":\"#13ce66\",\"inactive-color\":\"#ff4949\"},on:{\"change\":function (value) { return _vm.handleSwitchChange(scope.row, value); }}}):_vm._e()]}}])})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import request from '@/utils/request'\n\n// 用户配置网站p2p\nexport function p2pConfig(user_id, domain_id, data) {\n  return request({\n    url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control`,\n    method: 'post',\n    data\n  })\n}\n","<template>\n  <div :style=\"device === 'mobile' ? '' : 'padding: 30px 120px'\">\n    <el-alert :title=\"$t('p2pConfig.desc')\" style=\"margin-bottom: 20px\" />\n    <el-table border :data=\"tableData\" v-loading=\"loading\">\n      <el-table-column align=\"center\" prop=\"domain\" :label=\"$t('domainTable.domain')\"></el-table-column>\n      <el-table-column align=\"center\" :formatter=\"formatterStatus\" :label=\"$t('p2pConfig.status')\">\n        <template slot-scope=\"scope\">\n          <span :style=\"scope.row.blocked?'color: red':''\">\n            {{ formatterStatus(scope.row) }}\n          </span>\n        </template>\n      </el-table-column>\n      <el-table-column :label=\"$t('domainTable.operation')\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-switch v-if=\"!scope.row.blocked\" :value=\"!scope.row.disable_p2p\" active-color=\"#13ce66\" inactive-color=\"#ff4949\" @change=\"value => handleSwitchChange(scope.row, value)\"> </el-switch>\n        </template>\n      </el-table-column>\n    </el-table>\n  </div>\n</template>\n\n<script>\nimport { fetchUserDomain } from '@/api/userDomain'\nimport { p2pConfig } from '@/api/user/p2pConfig'\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'P2PConfig',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      switchValue: true\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'device'\n    ])\n  },\n  mounted() {\n    this.fetchTableData(1, 20)\n  },\n  methods: {\n    formatterStatus(row) {\n      if(row.blocked) {\n        return this.$t('p2pConfig.illegal')\n      }\n      return row.disable_p2p ? this.$t('p2pConfig.close') : this.$t('p2pConfig.open')\n    },\n    fetchTableData(page, pageSize) {\n      this.loading = true\n      fetchUserDomain(page, pageSize).then(res => {\n        if(res.data) {\n          this.tableData = res.data.filter(item => item.isValid === 1 )\n        }\n        this.loading = false\n      }).catch(err => {\n        this.loading = false\n        console.log(err)\n      })\n    },\n    // 检查是否可以关闭P2P\n    // checkCanCloseP2P() {\n    //   let openNum = 0\n    //   this.tableData.forEach(item => {\n    //     if(!item.blocked && !item.disable_p2p)\n    //       openNum += 1\n    //   })\n    //   return openNum >= 2 ? true : false\n    // },\n    handleP2PConfig(uid, id, data) {\n      this.loading = true\n      p2pConfig(uid, id, data)\n        .then(res => {\n          if(res.data.succeed) {\n            this.$message({\n              message: this.$t('p2pConfig.configSuccess'),\n              type: 'success'\n            })\n            this.tableData.forEach(item => {\n              if(item.id === id) {\n                item.disable_p2p = data.disable\n              }\n            })\n          } else {\n            this.$message.error(this.$t('p2pConfig.configFail'))\n          }\n          this.loading = false\n        })\n        .catch(err => {\n          this.loading = false\n          console.log(err)\n        })\n    },\n    handleSwitchChange(domain, value) {\n      const data = { disable: !value }\n      this.handleP2PConfig(domain.uid, domain.id, data)\n      // if(value) {\n      //   this.handleP2PConfig(domain.uid, domain.id, data)\n      // } else {\n      //   if(this.checkCanCloseP2P()) {\n      //     this.handleP2PConfig(domain.uid, domain.id, data)\n      //   } else {\n      //     this.$messageBox.alert(this.$t('p2pConfig.switchErr'), {\n      //       confirmButtonText: this.$t('common.ok')\n      //     })\n      //   }\n      // }\n    }\n  },\n}\n</script>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=6893df3f&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"index.vue\"\nexport default component.exports","import request from '@/utils/request'\nimport { getID } from '@/utils/auth'\n\n// 获取活跃域名总数\nexport function fetchHostNum() {\n  return request({\n    url: `host/num?ts=${((new Date().getTime()) / 1000).toFixed() - 1800}`,\n    method: 'get'\n  })\n}\n\n// 获取域名列表\nexport function fetchDomain(page, pageSize, order, filters) {\n  let url = `host?page=${page}&page_size=${pageSize}&order=${order}`\n  filters.forEach(item => {\n    if(item.value)\n      url += `&${item.name}=${item.value}`\n  })\n  return request({\n    url,\n    method: 'get'\n  })\n}\n\n// 将域名拉黑或从黑名单移除\nexport function blockDomain(data) {\n  return request({\n    url: `/host/block`,\n    method: 'post',\n    data\n  })\n}\n\n// 将域名加入或从白名单移除\nexport function whiteDomain(data) {\n  return request({\n    url: `/host/whitelist`,\n    method: 'post',\n    data\n  })\n}\n\n// 查找域名\nexport function searchHost(host) {\n  return request({\n    url: `host/search?keywords=${host}`,\n    method: 'get'\n  })\n}\n\n// 获取用户列表\nexport function fetchUserList(page, pageSize, order) {\n  return request({\n    url: `user?page=${page}&page_size=${pageSize}&order=${order}`,\n    method: 'get'\n  })\n}\n\n// 获取某用户的域名列表\nexport function fetchUserDomain(page, pageSize) {\n  return request({\n    url: `user/user_id/${getID()}/domain?page=${page}&page_size=${pageSize}`,\n    method: 'get'\n  })\n}\n\n// 绑定域名\nexport function bindDomain(data) {\n  return request({\n    url: `user/user_id/${getID()}/domain`,\n    method: 'post',\n    data\n  })\n}\n\n// 认证域名\nexport function checkDomain(domainID) {\n  return request({\n    url: `user/user_id/${getID()}/domain/domain_id/${domainID}`,\n    method: 'post'\n  })\n}\n\n// 用户删除域名\nexport function deleteDomain(domainID) {\n  return request({\n    url: `user/user_id/${getID()}/domain/domain_id/${domainID}`,\n    method: 'delete'\n  })\n}\n\n// 管理员权限用户列表\nexport function fetchAdminUser() {\n  return request({\n    url: `user/admin`,\n    method: 'get'\n  })\n}"],"sourceRoot":""}